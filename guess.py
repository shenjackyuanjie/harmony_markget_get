import matplotlib.pyplot as plt
import matplotlib.font_manager as fm
from collections import Counter

plt.rcParams["font.sans-serif"] = ["Microsoft YaHei"]
# fm._load_fontmanager(try_read_cache=False)
plt.rcParams["axes.unicode_minus"] = False

ids = [
    6917559133889396578,
    6917559134045802769,
    6917559138770331354,
    6917559303873561126,
    6917559384755888642,
    6917559398244134093,
    6917559420741644814,
    6917559471584581139,
    6917559997337903225,
    6917560003449022390,
    6917560032190348725,
    6917560035472143514,
    6917560097545123074,
    6917560114894371183,
    6917560117815577197,
    6917560205485137936,
    6917560219685269679,
    6917560359557165039,
    6917560360240524900,
    6917560379007636106,
    6917560381488384466,
    6917560393396693554,
    6917560460010884000,
    6917560575682608482,
    6917560627823550829,
    6917560704310608396,
    6917560710101080351,
    6917560737288133186,
    6917560816735994213,
    6917560825146198131,
    6917560887149340958,
    6917560893620646027,
    6917560993344198571,
    6917561085175127541,
    6917561518769085516,
    6917561528753048064,
    6917561531299586643,
    6917561531516369629,
    6917561964332820229,
    6917561975170776755,
    6917562054572335088,
    6917562055503460269,
    6917562062336371751,
    6917562117895025847,
    6917562146058315651,
    6917562236242776348,
    6917562410160572883,
    6917562416591618661,
    6917562428991776541,
    6917562482635766975,
    6917562688923896242,
    6917562776558909659,
    6917562852705310360,
    6917562860125809446,
    6917563099052308461,
    6917563105682348563,
    6917563117770958650,
    6917563207242249463,
    6917563210700492667,
    6917563223688686071,
    6917563291128459951,
    6917563291504975184,
    6917563296127491191,
    6917563298033320511,
    6917563480243169326,
    6917563579888284722,
    6917564619841120088,
    6917564622717528193,
    6917564629425766301,
    6917564778013159272,
    6917564780618548498,
    6917564793736383697,
    6917564970631252633,
    6917565076343758158,
    6917565094283006496,
    6917565156154031520,
    6917565246979711402,
    6917565574002278537,
    6917565660152131290,
    6917565664998051521,
    6917565870594334636,
    6917565942084007761,
    6917565943860685251,
    6917565953574060639,
    6917565957880247226,
    6917566017622549052,
    6917566063314023436,
    6917566197931927039,
    6917566464181517375,
    6917566468465598293,
    6917566474084827743,
    6917566478212166079,
    6917566499590326510,
    6917566575432550076,
    6917566833160823598,
    6917566846658886649,
    6917566928267548033,
    6917566934976224854,
    6917566993800467538,
    6917567017504378639,
    6917567167085444581,
    6917567203004320643,
    6917567444557272466,
    6917567452818117549,
    6917567456642765442,
    6917567523845082942,
    6917567633286766831,
    6917567702950680722,
    6917567718859823527,
    6917568071787569667,
    6917568155815349841,
    6917568155867117123,
    6917568155924191221,
    6917568163513164194,
    6917568178765577243,
    6917568232894241582,
    6917568244069189304,
    6917568256496536565,
    6917568333869851906,
    6917568334958783334,
    6917568406010735924,
    6917568413523373824,
    6917568420318492071,
    6917568427686399547,
    6917568684925813728,
    6917568686446279577,
    6917568776164361876,
    6917568780751830075,
    6917568870394557501,
    6917568938793065918,
    6917568961486342650,
    6917569038087003052,
    6917569052153882551,
    6917569292929922757,
    6917569318010805689,
    6917569485257269136,
    6917569486553345803,
    6917569570277780051,
    6917569918648344075,
    6917569934682582171,
    6917570019123797324,
    6917570028795781894,
    6917570086327441425,
    6917570106963681171,
    6917570114906081657,
    6917570176151307733,
    6917570551722000484,
    6917570619142111660,
    6917570721961751670,
    6917570883820831744,
    6917570930642172876,
    6917571258477204267,
    6917571259095375000,
    6917571259236472421,
    6917571259266496564,
    6917571419801602200,
    6917571443665619579,
    6917571499894472360,
    6917571524421821540,
    6917571695489807926,
    6917571769447717642,
    6917571853144544646,
    6917571887876321708,
    6917572591656122449,
    6917572608391425552,
    6917572656972399306,
    6917572676822904752,
    6917572680058311502,
    6917572774833520026,
    6917573096489696019,
    6917573101074807106,
    6917573276924071425,
    6917573277348776991,
    6917573362181547164,
    6917573382401539435,
    6917573585413902005,
    6917573641049123996,
    6917573734435800604,
    6917573740759225495,
    6917573751208600902,
    6917573824998082323,
    6917573895356098652,
    6917574006467689797,
    6917574019416029772,
    6917574246871563021,
    6917574338158023289,
    6917574429568883480,
    6917574535600529448,
    6917574541563381540,
    6917574976217876004,
    6917575067983185084,
    6917575311663266475,
    6917575490299182232,
    6917575575408218940,
    6917575679104783651,
    6917575753821375390,
    6917575866364310009,
    6917575866685513354,
    6917575958166941359,
    6917576279784877416,
    6917576295788199458,
    6917576300561578512,
    6917576307501285152,
    6917576402744458295,
    6917576402800277946,
    6917576402836335409,
    6917576475972072500,
    6917576717883984780,
    6917576738961742174,
    6917576746863481956,
    6917576838011464105,
    6917576940755480783,
    6917576940937516838,
    6917577059663585648,
    6917577102515049362,
    6917577107922628002,
    6917577215231968912,
    6917577523340136817,
    6917577556043683664,
    6917577608495032307,
    6917577631815379178,
    6917577636815176767,
    6917577987944692812,
    6917578051954011073,
    6917578188665242045,
    6917578447188324130,
    6917578507629570170,
    6917578599493067933,
    6917578699992887492,
    6917578775068060754,
    6917578784319508782,
    6917579204242408693,
    6917579559966314556,
    6917579834299978384,
    6917579936380018938,
    6917579998279697395,
    6917580177192181778,
    6917580186928988092,
    6917580441800186164,
    6917580461600672398,
    6917580461811772382,
    6917580469924515654,
    6917580623403769742,
    6917580742011695575,
    6917580791028533517,
    6917580987457436303,
    6917581068644479898,
    6917581092117358438,
    6917581167048208704,
    6917581235268169281,
    6917581246205083775,
    6917581322722941979,
    6917581345798981836,
    6917581349076424258,
    6917581408869642091,
    6917581439889763005,
    6917581488322736351,
    6917581499008571810,
    6917581509377615640,
    6917581576706636714,
    6917581595850083390,
    6917581604376071830,
    6917581679923240987,
    6917581706026861856,
    6917581726356529829,
    6917581788029550089,
    6917581853836406760,
    6917581856118665464,
    6917581867584077332,
    6917581877515507899,
    6917581884478456091,
    6917582040807317308,
    6917582053601850361,
    6917582078787899138,
    6917582142518834865,
    6917582257697718930,
    6917582293540250385,
    6917582308180359750,
    6917582317358748027,
    6917582319868409659,
    6917582335953462424,
    6917582423733096431,
    6917582479752260075,
    6917582499094936004,
    6917582502415600029,
    6917582516140382012,
    6917582563464205266,
    6917582563940938482,
    6917582592889072750,
    6917582606873287353,
    6917582650143152962,
    6917582651590622115,
    6917582652203912674,
    6917582655891050574,
    6917582741623384861,
    6917582753968250213,
    6917582836887453255,
    6917582840859348667,
    6917582847714036185,
    6917582870117625124,
    6917582874465808359,
    6917582927712855605,
    6917582930249724708,
    6917582941360775100,
    6917582947215272222,
    6917583005836244466,
    6917583009543718816,
    6917583023367078835,
    6917583029779617000,
    6917583034420693126,
    6917583046228646879,
    6917583193401088948,
    6917583220442027967,
    6917583271540398443,
    6917583299147370650,
    6917583307141716702,
    6917583371870121691,
    6917583378448071704,
    6917583468375714205,
    6917583561716228418,
    6917583650713903295,
    6917583652792628434,
    6917583656220575303,
    6917583671975209364,
    6917583709358005339,
    6917583727675732329,
    6917583728375471080,
    6917583737580426767,
    6917583816625373824,
    6917583816696099344,
    6917583817307454834,
    6917583914153825581,
    6917583974684958321,
    6917584007873268157,
    6917584010782440349,
    6917584041739720322,
    6917584074797981171,
    6917584101825961118,
    6917584172927535610,
    6917584179948190159,
    6917584180271808000,
    6917584264893306175,
    6917584270019554473,
    6917584330588767332,
    6917584354362448900,
    6917584361454081323,
]

# 计算相邻差值
deltas = [ids[i + 1] - ids[i] for i in range(len(ids) - 1)]

# delta % 4096 的频率
mod_4096 = [d % 4096 for d in deltas]
mod_counter = Counter(mod_4096)


# 计算二进制末尾零函数
def trailing_zeros(n):
    return (n & -n).bit_length() - 1 if n != 0 else 64


# 统计末尾零分布
tz_counts = Counter(trailing_zeros(d) for d in deltas)

# 可视化
plt.style.use("seaborn-v0_8")
fig, axs = plt.subplots(2, 1, figsize=(10, 8))

# delta % 4096 分布
axs[0].bar(mod_counter.keys(), mod_counter.values(), color="steelblue")
axs[0].set_title("Delta % 4096 分布")
axs[0].set_xlabel("delta % 4096")
axs[0].set_ylabel("频数")

# 末尾零分布
tz_keys = sorted(tz_counts.keys())
axs[1].bar(tz_keys, [tz_counts[k] for k in tz_keys], color="darkorange")
axs[1].set_title("Delta 二进制末尾零分布")
axs[1].set_xlabel("Trailing Zeros (bit)")
axs[1].set_ylabel("频数")

plt.tight_layout()
plt.savefig("id_delta_analysis.png")

# 输出统计结果
print("Delta % 4096 最常见的余数:", mod_counter.most_common(100))
print("Trailing zeros 分布:", dict(tz_counts))

print(mod_4096)
print(deltas)
